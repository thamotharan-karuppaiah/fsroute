<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>FreshRoute - Settings</title>
  <link rel="stylesheet" href="options.css">
    
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <div class="header-left">
          <h1>
            <span class="header-logo">
              <img src="icons/icon128.png" alt="FreshRoute Logo">
            </span>
            FreshRoute
          </h1>
          <p>Configure URL rewrite rules and header modifications</p>
        </div>
        <div class="header-right">
          <div class="tab-navigation">
            <div class="nav-tabs">
              <button class="nav-tab active" id="rulesTab">Rules üîß</button>
              <button class="nav-tab" id="settingsTab">Settings ‚öôÔ∏è</button>
            </div>
            <div class="nav-actions">
              <button class="btn btn-secondary" id="dashboardBtn">
                <span>üìä</span>
                <span>Dashboard</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="content">
      <!-- Rules Content (Primary View) -->
      <div id="rulesView" class="main-view active">
        <!-- Unified Rules Section -->
        <div class="section">
          <div class="section-header">
            <div class="section-title">Rules & Groups</div>
            <div class="section-actions">
              <div class="import-export-section">
                <input type="file" id="importFile" class="hidden-file-input" accept=".json">
                <button class="import-btn" id="importBtn">Import</button>
              </div>
              <button class="add-preset-btn" id="addPresetGroupBtn">Add Preset Group</button>
              <button class="add-group-btn" id="addGroupBtn">Add Group</button>
            </div>
          </div>
          
          <div id="allGroups"></div>
        </div>
      </div>

      <!-- Settings Content (Secondary View) -->
      <div id="settingsView" class="main-view">
        <div class="settings-header">
          <button class="back-to-rules-btn" id="backToRulesBtn">
            <span class="back-icon">‚Üê</span>
            <span class="back-text">Back to Rules</span>
          </button>
          <h2>Extension Settings</h2>
        </div>

        <!-- Environment Variables Section -->
        <div class="section">
          <div class="section-header">
            <div class="section-title">Environment Variables</div>
            <div class="section-actions">
              <button class="add-rule-btn" id="addEnvironmentVariableBtn">Add Variable</button>
            </div>
          </div>
          
          <div class="settings-card">
            <div class="settings-row">
              <div class="settings-description">
                <div class="settings-title">üìã Environment Variables</div>
                <div class="settings-subtitle">Define reusable variables to avoid repetition. Use <code>{{variableName}}</code> in any input field to reference these variables.<br>
                üí° Start typing <code>{{</code> to see inline suggestions, or press <code>Ctrl+Tab</code> for manual suggestions.<br>
                üí° Example: Create <code>LOCAL_DOMAIN</code> = <code>localhost.freshservice-dev.com</code>, then use <code>{{LOCAL_DOMAIN}}</code> in URL patterns.</div>
              </div>
            </div>
          </div>
          
          <div id="environmentVariables">
            <!-- Environment variables will be rendered here -->
          </div>
        </div>

        <!-- Extension Settings Section -->
        <div class="section">
          <div class="section-header">
            <div class="section-title">Extension Settings</div>
          </div>
          
          <div class="settings-card">
            <div class="settings-row">
              <div class="settings-description">
                <div class="settings-title">Show Rule Notifications</div>
                <div class="settings-subtitle">Display toast notifications when rules are applied to web pages. Notifications auto-hide after 5 seconds and won't duplicate for the same rule.</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="notificationsEnabledToggle">
                <span class="slider"></span>
              </label>
            </div>
          </div>
          
          <div class="settings-card">
            <div class="settings-row">
              <div class="settings-description">
                <div class="settings-title">Compact View for Notifications</div>
                <div class="settings-subtitle">Show only one notification at a time with navigation arrows (‚Üê ‚Üí) to move between them. The latest notification is shown by default. Requires notifications to be enabled.</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="compactNotificationsToggle" checked>
                <span class="slider"></span>
              </label>
            </div>
          </div>
          
          <div class="settings-card">
            <div class="settings-row">
              <div class="settings-description">
                <div class="settings-title">Export Environment Variables with Rules</div>
                <div class="settings-subtitle">When enabled, environment variables will be included in exported JSON files. During import, environment variables will be created if they don't already exist with the same name.</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" id="exportEnvironmentVariablesToggle">
                <span class="slider"></span>
              </label>
            </div>
          </div>
          
          <div class="settings-card">
            <div class="settings-row">
              <div class="settings-description">
                <div class="settings-title">Unified Rule Groups</div>
                <div class="settings-subtitle">‚úÖ Mixed Rule Types: Each group can contain both URL rewrite and header modification rules<br>
                üîß Flexible Organization: Organize rules by project, environment, or purpose<br>
                üìã Easy Management: Add, edit, enable/disable rules within groups</div>
              </div>
            </div>
          </div>
          
          <div class="settings-card">
            <div class="settings-row">
              <div class="settings-description">
                <div class="settings-title">Export & Import Rules</div>
                <div class="settings-subtitle">üì§ Export groups as JSON files for backup or sharing<br>
                üì• Import rules from JSON files<br>
                üóÇÔ∏è Groups can contain both URL rewrite and header modification rules</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      FreshRoute v1.0.0 - Built for productivity
    </div>
  </div>

  <!-- URL Rule Modal -->
  <div id="urlRuleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Add/Edit URL Rewrite Rule</div>
        <span class="close" id="closeUrlModal">&times;</span>
      </div>
      
      <div class="form-group">
        <label class="form-label">Matching Type</label>
        <select id="matchingType" class="form-select">
          <option value="regex">Regular Expression (Advanced)</option>
          <option value="contains">URL Contains Text</option>
          <option value="equals">URL Equals Exactly</option>
          <option value="startsWith">URL Starts With</option>
          <option value="endsWith">URL Ends With</option>
          <option value="wildcard">Wildcard Pattern (Simple)</option>
        </select>
        <div class="small-text">Choose how to match the source URL. Use "Contains" or "Equals" for simple cases, or "Regular Expression" for advanced patterns.</div>
      </div>
      
      <div class="form-group">
        <label class="form-label" id="sourceUrlLabel">Source URL Pattern</label>
        <input type="text" id="sourceUrl" class="form-input" placeholder="e.g., http://localhost.freshservice-dev.com:8080/(.*)">
        <div class="small-text" id="sourceUrlHelp">Use regex patterns. Use (.*) or $1, $2 for capture groups. Use {{VARIABLE_NAME}} for environment variables. Press Ctrl+Tab for variable suggestions.</div>
        
        <!-- Show Test Button -->
        <button type="button" class="btn-test-toggle" id="toggleSourceUrlTest">
          <span class="toggle-text">Show Test</span> üß™
        </button>
        
        <!-- Regex Test Section -->
        <div class="regex-test-section" id="sourceUrlTestSection" style="display: none;">
          <label class="form-label">Test Your Regex Pattern</label>
          <div class="regex-test-row">
            <input type="text" id="sourceUrlTest" class="form-input regex-test-input" placeholder="Enter a URL to test against your pattern">
            <button type="button" class="btn btn-secondary regex-test-btn" id="testSourceUrlBtn">Test</button>
          </div>
          <div class="regex-result" id="sourceUrlResult"></div>
          
          <!-- Common Pattern Examples -->
          <div class="regex-examples">
            <label class="form-label">Common Patterns:</label>
            <div class="example-buttons">
              <button type="button" class="btn-example" data-target="sourceUrl" data-pattern="https?://localhost:(\d+)/(.*)">Localhost with port</button>
              <button type="button" class="btn-example" data-target="sourceUrl" data-pattern="https?://([^.]+)\.example\.com/(.*)">Subdomain capture</button>
              <button type="button" class="btn-example" data-target="sourceUrl" data-pattern="https?://api\.([^.]+)\.com/v(\d+)/(.*)">API versioning</button>
              <button type="button" class="btn-example" data-target="sourceUrl" data-pattern="https?://([^/]+)/api/(.*)">Domain + API path</button>
              <button type="button" class="btn-example" data-target="sourceUrl" data-pattern="http://localhost:*/api/*">Wildcard port + path</button>
              <button type="button" class="btn-example" data-target="sourceUrl" data-pattern="https://*.example.com/*">Wildcard subdomain</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Target URL</label>
        <input type="text" id="targetUrl" class="form-input" placeholder="e.g., https://share-freshgladiators-m4008.freshgladiators.com/$1">
        <div class="small-text" id="targetUrlHelp">Use $1, $2, etc. to reference capture groups from source pattern. Use {{VARIABLE_NAME}} for environment variables.</div>
        
        <!-- Target URL Examples -->
        <div class="regex-examples" id="targetUrlExamples" style="display: none;">
          <label class="form-label">Target URL Examples:</label>
          <div class="example-buttons">
            <button type="button" class="btn-example" data-target="targetUrl" data-pattern="https://production.example.com:$1/$2">Port + path mapping</button>
            <button type="button" class="btn-example" data-target="targetUrl" data-pattern="https://$1-prod.example.com/$2">Subdomain to prod</button>
            <button type="button" class="btn-example" data-target="targetUrl" data-pattern="https://api.prod.com/v$2/$3">API version mapping</button>
            <button type="button" class="btn-example" data-target="targetUrl" data-pattern="https://$1.myservice.com/api/$2">Domain transformation</button>
            <button type="button" class="btn-example" data-target="targetUrl" data-pattern="https://prod.example.com:$1/api/$2">Wildcard mapping</button>
            <button type="button" class="btn-example" data-target="targetUrl" data-pattern="https://$1.production.com/$2">Wildcard subdomain mapping</button>
          </div>
        </div>
        
        <!-- Target URL Preview -->
        <div class="regex-preview-section" id="targetUrlPreview"></div>
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelUrlRuleBtn">Cancel</button>
        <button class="btn btn-success" id="saveUrlRuleBtn">Save Rule</button>
      </div>
    </div>
  </div>

  <!-- Header Rule Modal -->
  <div id="headerRuleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Add/Edit Header Modification Rule</div>
        <span class="close" id="closeHeaderModal">&times;</span>
      </div>
      
      <div class="form-group">
        <label class="form-label">Matching Type</label>
        <select id="headerMatchingType" class="form-select">
          <option value="regex">Regular Expression (Advanced)</option>
          <option value="contains">URL Contains Text</option>
          <option value="equals">URL Equals Exactly</option>
          <option value="startsWith">URL Starts With</option>
          <option value="endsWith">URL Ends With</option>
          <option value="wildcard">Wildcard Pattern (Simple)</option>
        </select>
        <div class="small-text">Choose how to match URLs where headers should be modified. Use "Contains" or "Equals" for simple cases, or "Regular Expression" for advanced patterns.</div>
      </div>
      
      <div class="form-group">
        <label class="form-label" id="headerUrlLabel">URL Pattern</label>
        <input type="text" id="headerUrlPattern" class="form-input" placeholder="e.g., https://api\\.example\\.com/.*">
        <div class="small-text" id="headerUrlHelp">Regex pattern to match URLs where headers should be modified. Use {{VARIABLE_NAME}} for environment variables.</div>
        
        <!-- Show Test Button -->
        <button type="button" class="btn-test-toggle" id="toggleHeaderUrlTest">
          <span class="toggle-text">Show Test</span> üß™
        </button>
        
        <!-- Regex Test Section -->
        <div class="regex-test-section" id="headerUrlTestSection" style="display: none;">
          <label class="form-label">Test Your URL Pattern</label>
          <div class="regex-test-row">
            <input type="text" id="headerUrlTest" class="form-input regex-test-input" placeholder="Enter a URL to test against your pattern">
            <button type="button" class="btn btn-secondary regex-test-btn" id="testHeaderUrlBtn">Test</button>
          </div>
          <div class="regex-result" id="headerUrlResult"></div>
          
          <!-- Common Pattern Examples -->
          <div class="regex-examples">
            <label class="form-label">Common Patterns:</label>
            <div class="example-buttons">
              <button type="button" class="btn-example" data-target="headerUrlPattern" data-pattern="https?://api\..*">Any API domain</button>
              <button type="button" class="btn-example" data-target="headerUrlPattern" data-pattern="https?://.*\.googleapis\.com/.*">Google APIs</button>
              <button type="button" class="btn-example" data-target="headerUrlPattern" data-pattern="https?://([^.]+\.)?example\.com/.*">Example.com domains</button>
              <button type="button" class="btn-example" data-target="headerUrlPattern" data-pattern="https?://.*\.(jpg|png|gif|svg)$">Image files</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="headers-section">
        <label class="form-label">Headers to Modify</label>
        <div class="headers-list" id="headersList"></div>
        <button class="add-header-btn" id="addHeaderFieldBtn">Add Header</button>
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelHeaderRuleBtn">Cancel</button>
        <button class="btn btn-success" id="saveHeaderRuleBtn">Save Rule</button>
      </div>
    </div>
  </div>

  <!-- Group Modal -->
  <div id="groupModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Add/Edit Group</div>
        <span class="close" id="closeGroupModal">&times;</span>
      </div>
      
      <div class="form-group">
        <label class="form-label">Group Name</label>
        <input type="text" id="groupName" class="form-input" placeholder="e.g., Development Environment">
        <div class="small-text">Choose a descriptive name for your group</div>
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelGroupBtn">Cancel</button>
        <button class="btn btn-success" id="saveGroupBtn">Save Group</button>
      </div>
    </div>
  </div>

  <!-- Preset Group Modal -->
  <div id="presetModal" class="modal">
    <div class="modal-content preset-modal-content">
      <div class="modal-header">
        <div class="modal-title">Create Preset Group</div>
        <span class="close" id="closePresetModal">&times;</span>
      </div>
      
      <!-- Preset Selection -->
      <div id="presetSelection">
        <div class="preset-intro">
          <p>Choose a preset template to quickly set up a group with predefined rules. You can customize the variables to match your environment.</p>
        </div>
        
        <div class="presets-container" id="presetsList">
          <!-- Presets will be dynamically generated here -->
        </div>
      </div>
      
      <!-- Preset Configuration -->
      <div id="presetConfiguration" style="display: none;">
        <div class="preset-config-header">
          <button class="btn btn-text preset-back-btn" id="presetBackBtn">
            ‚Üê Back to Templates
          </button>
          <h3 id="presetConfigTitle">Configure Preset</h3>
        </div>
        
        <div class="preset-config-form" id="presetConfigForm">
          <!-- Configuration form will be dynamically generated here -->
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-secondary" id="cancelPresetBtn">Cancel</button>
          <button class="btn btn-success" id="createPresetGroupBtn">Create Group</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Environment Variable Modal -->
  <div id="environmentVariableModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Add/Edit Environment Variable</div>
        <span class="close" id="closeEnvironmentVariableModal">&times;</span>
      </div>
      
      <div class="form-group">
        <label class="form-label">Variable Name</label>
        <input type="text" id="environmentVariableName" class="form-input" placeholder="e.g., LOCAL_DOMAIN, API_KEY, BASE_URL">
        <div class="small-text">Use uppercase letters, numbers, and underscores only. No spaces or special characters.</div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Variable Value</label>
        <input type="text" id="environmentVariableValue" class="form-input" placeholder="e.g., localhost.freshservice-dev.com, your-api-key">
        <div class="small-text">The value that will replace <code>{{variableName}}</code> in your rules.</div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Description (Optional)</label>
        <input type="text" id="environmentVariableDescription" class="form-input" placeholder="Brief description of what this variable is used for">
        <div class="small-text">Optional description to help remember what this variable is for.</div>
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-secondary" id="cancelEnvironmentVariableBtn">Cancel</button>
        <button class="btn btn-success" id="saveEnvironmentVariableBtn">Save Variable</button>
      </div>
    </div>
  </div>

  <script src="options.js"></script>
</body>
</html> 